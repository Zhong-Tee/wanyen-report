<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .icon { width: 24px; height: 24px; display: inline-block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 p-6">
    <div id="root">Loading...</div>

    <script type="text/babel">
        const { useMemo, useState } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
            LineChart, Line, PieChart, Pie, Cell, AreaChart, Area 
        } = Recharts;

        // --- Mock Data (ข้อมูลตัวอย่างเพื่อให้กราฟขึ้น) ---
        const BranchGroup = {
            MOSHI: 'Moshi Moshi',
            B2S: 'B2S',
            WANYEN: 'Wanyen',
            UNKNOWN: 'Other'
        };

        const COLORS = {
            [BranchGroup.MOSHI]: '#ec4899',
            [BranchGroup.B2S]: '#eab308',
            [BranchGroup.WANYEN]: '#3b82f6',
            [BranchGroup.UNKNOWN]: '#94a3b8'
        };

        // สร้างข้อมูลจำลอง 30 วัน
        const generateData = () => {
            const data = [];
            const branches = ['Central World', 'Siam Paragon', 'Mega Bangna', 'Icon Siam', 'Ladprao'];
            const products = ['Sticker A', 'Notebook B', 'Pen C', 'Tape D'];
            
            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - (29 - i));
                
                // สุ่มข้อมูล
                const branch = branches[Math.floor(Math.random() * branches.length)];
                let group = BranchGroup.UNKNOWN;
                if(branch.includes('Central')) group = BranchGroup.B2S;
                else if(branch.includes('Siam')) group = BranchGroup.MOSHI;
                else group = BranchGroup.WANYEN;

                data.push({
                    date: date,
                    branch: branch,
                    branchGroup: group,
                    product: products[Math.floor(Math.random() * products.length)],
                    quantity: Math.floor(Math.random() * 50) + 1,
                    totalSales: Math.floor(Math.random() * 5000) + 500
                });
            }
            return data;
        };

        const SAMPLE_DATA = generateData();

        // --- Utility Functions ---
        const formatCurrency = (val) => 
            new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', minimumFractionDigits: 0 }).format(val);

        const formatNumber = (val) => 
            new Intl.NumberFormat('th-TH').format(val);
        
        const formatDate = (date) => {
            return date.toLocaleDateString('en-GB'); // dd/mm/yyyy
        }

        // --- Components ---
        const KPICard = ({ title, value, subtext, color }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-start justify-between">
                <div>
                    <p className="text-sm font-medium text-slate-500 mb-1">{title}</p>
                    <h3 className="text-2xl font-bold text-slate-800">{value}</h3>
                    {subtext && <p className="text-xs text-slate-400 mt-2">{subtext}</p>}
                </div>
                <div className={`p-3 rounded-lg ${color} text-white font-bold`}>
                    $ 
                </div>
            </div>
        );

        const Dashboard = ({ data }) => {
            // Logic การคำนวณเดิมของคุณ
            const kpis = useMemo(() => {
                const totalRevenue = data.reduce((acc, curr) => acc + curr.totalSales, 0);
                const totalQuantity = data.reduce((acc, curr) => acc + curr.quantity, 0);
                const totalOrders = data.length;
                const uniqueBranches = new Set(data.map(d => d.branch)).size;

                return {
                    totalRevenue,
                    totalQuantity,
                    totalOrders,
                    avgOrderValue: totalOrders > 0 ? totalRevenue / totalOrders : 0,
                    avgPricePerUnit: totalQuantity > 0 ? totalRevenue / totalQuantity : 0,
                    totalBranches: uniqueBranches
                };
            }, [data]);

            const timeSeriesData = useMemo(() => {
                const grouped = data.reduce((acc, curr) => {
                    const key = formatDate(curr.date);
                    if (!acc[key]) acc[key] = { date: key, sales: 0, sortTime: curr.date.getTime() };
                    acc[key].sales += curr.totalSales;
                    return acc;
                }, {});

                return Object.values(grouped).sort((a, b) => a.sortTime - b.sortTime);
            }, [data]);

            const groupSalesData = useMemo(() => {
                const grouped = data.reduce((acc, curr) => {
                    if (!acc[curr.branchGroup]) acc[curr.branchGroup] = 0;
                    acc[curr.branchGroup] += curr.totalSales;
                    return acc;
                }, {});

                return Object.keys(grouped).map(key => ({ name: key, value: grouped[key] }));
            }, [data]);

            const topBranches = useMemo(() => {
                const grouped = data.reduce((acc, curr) => {
                    if (!acc[curr.branch]) acc[curr.branch] = { sales: 0, group: curr.branchGroup };
                    acc[curr.branch].sales += curr.totalSales;
                    return acc;
                }, {});

                return Object.entries(grouped)
                    .map(([name, d]) => ({ name, value: d.sales, group: d.group }))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, 5);
            }, [data]);

            return (
                <div className="space-y-6 max-w-7xl mx-auto">
                    <h1 className="text-2xl font-bold text-slate-800">Sales Dashboard Example</h1>
                    
                    {/* KPI Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <KPICard title="Total Sales" value={formatCurrency(kpis.totalRevenue)} subtext={`${formatNumber(kpis.totalOrders)} transactions`} color="bg-blue-600" />
                        <KPICard title="Total Quantity" value={formatNumber(kpis.totalQuantity)} subtext="Units sold" color="bg-emerald-500" />
                        <KPICard title="Avg. Price / Unit" value={formatCurrency(kpis.avgPricePerUnit)} subtext="Rev / Qty" color="bg-indigo-500" />
                        <KPICard title="Active Branches" value={formatNumber(kpis.totalBranches)} subtext="Locations" color="bg-rose-500" />
                    </div>

                    {/* Charts Row */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 className="text-lg font-bold mb-4">Sales Trend</h3>
                            <div className="h-80">
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={timeSeriesData}>
                                        <defs>
                                            <linearGradient id="colorSales" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                                                <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="date" tick={{fontSize: 12}} />
                                        <YAxis tickFormatter={(val) => `${val/1000}k`} tick={{fontSize: 12}} />
                                        <Tooltip formatter={(value) => formatCurrency(value)} />
                                        <Area type="monotone" dataKey="sales" stroke="#3b82f6" fillOpacity={1} fill="url(#colorSales)" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 className="text-lg font-bold mb-4">Sales by Group</h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie data={groupSalesData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                            {groupSalesData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={COLORS[entry.name] || '#999'} />
                                            ))}
                                        </Pie>
                                        <Tooltip formatter={(value) => formatCurrency(value)} />
                                        <Legend />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    </div>

                    {/* Table Row */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 className="text-lg font-bold mb-4">Top Branches</h3>
                        <table className="w-full text-sm text-left">
                            <thead className="bg-slate-50 text-slate-600 uppercase">
                                <tr>
                                    <th className="px-4 py-3">Rank</th>
                                    <th className="px-4 py-3">Branch</th>
                                    <th className="px-4 py-3 text-right">Sales</th>
                                </tr>
                            </thead>
                            <tbody>
                                {topBranches.map((branch, idx) => (
                                    <tr key={idx} className="border-b border-slate-50 last:border-0 hover:bg-slate-50">
                                        <td className="px-4 py-3">#{idx + 1}</td>
                                        <td className="px-4 py-3 font-medium">{branch.name}</td>
                                        <td className="px-4 py-3 text-right font-bold text-emerald-600">{formatCurrency(branch.value)}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const App = () => {
            return <Dashboard data={SAMPLE_DATA} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
